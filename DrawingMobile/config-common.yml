# Common configuration shared across all DrawingMobile iOS project variants
# Include this file in project-*.yml files
#
# Usage in project files:
#   include:
#     - config-common.yml
#   targets:
#     MyTarget:
#       templates: [CommonSources]
#       settings:
#         groups: [CommonHeaders, CommonFrameworks]

# ============================================================================
# Common Options
# ============================================================================
options:
  bundleIdPrefix: com.vybe
  deploymentTarget:
    iOS: "17.0"
  xcodeVersion: "15.0"
  generateEmptyDirectories: true
  groupSortPosition: top

# ============================================================================
# Common Settings
# ============================================================================
settings:
  base:
    MARKETING_VERSION: "1.0.0"
    CURRENT_PROJECT_VERSION: "1"
    DEVELOPMENT_TEAM: "GNRTKYX7C4"
    CODE_SIGN_STYLE: Automatic
    ENABLE_BITCODE: NO
    CLANG_CXX_LANGUAGE_STANDARD: c++20
    CLANG_CXX_LIBRARY: libc++

# ============================================================================
# Setting Groups (reusable build settings)
# ============================================================================
settingGroups:
  CommonHeaders:
    HEADER_SEARCH_PATHS:
      - $(PROJECT_DIR)/../vendor/imgui
      - $(PROJECT_DIR)/../vendor/imgui/backends
      - $(PROJECT_DIR)/../vendor/flecs/distr
      - $(PROJECT_DIR)/../vendor
      - $(PROJECT_DIR)/Frameworks/include
      - $(PROJECT_DIR)/Frameworks/include/SDL3
      # jank headers (uses JANK_SRC env var, substituted at xcodegen time)
      - ${JANK_SRC}/include/cpp
      - ${JANK_SRC}/src/cpp
      - ${JANK_SRC}/third-party/immer
      - ${JANK_SRC}/third-party/bdwgc/include
      - ${JANK_SRC}/third-party/boost-preprocessor/include
      - ${JANK_SRC}/third-party/boost-multiprecision/include
      - ${JANK_SRC}/third-party/folly
      - ${JANK_SRC}/third-party/stduuid/include
    FRAMEWORK_SEARCH_PATHS:
      - $(PROJECT_DIR)/Frameworks
    LD_RUNPATH_SEARCH_PATHS:
      - "@executable_path/Frameworks"

  CommonCodeSign:
    CODE_SIGN_IDENTITY: "Apple Development"
    CODE_SIGNING_REQUIRED: "YES"
    CODE_SIGNING_ALLOWED: "YES"

  JITHeaders:
    # Additional headers for JIT builds (LLVM/Clang)
    HEADER_SEARCH_PATHS:
      - ${JANK_SRC}/third-party/cppinterop/include

# ============================================================================
# Target Templates
# ============================================================================
targetTemplates:
  CommonSources:
    sources:
      - path: main.mm
        compilerFlags: ["-x", "objective-c++"]
      - path: drawing_mobile_ios.mm
        compilerFlags: ["-x", "objective-c++"]
      # ImGui sources (for debug UI)
      - path: ../vendor/imgui/imgui.cpp
      - path: ../vendor/imgui/imgui_draw.cpp
      - path: ../vendor/imgui/imgui_widgets.cpp
      - path: ../vendor/imgui/imgui_tables.cpp
      - path: ../vendor/imgui/backends/imgui_impl_sdl3.cpp
      - path: ../vendor/imgui/backends/imgui_impl_sdlrenderer3.cpp
      # Flecs ECS (needed for vybe.type and vybe.flecs)
      - path: ../vendor/flecs/distr/flecs.c
        compilerFlags: ["-O2"]
      # Vybe Flecs helpers (needed for vybe.flecs jank bindings)
      - path: ../vendor/vybe/vybe_flecs_jank.cpp
        compilerFlags: ["-O2"]
      # Metal stamp renderer (GPU-accelerated brush rendering)
      - path: jank-resources/src/jank/vybe/app/drawing/native/metal_renderer.mm
        compilerFlags: ["-x", "objective-c++", "-fobjc-arc"]
      # Metal shaders (compiled to .metallib by Xcode)
      - path: jank-resources/src/jank/vybe/app/drawing/native/stamp_shaders.metal
      # Common resources (bundled with app)
      - path: LaunchScreen.storyboard
        buildPhase: resources
    dependencies:
      - framework: Frameworks/SDL3.xcframework
        embed: true

  # JIT-specific resources template
  JITResources:
    sources:
      # jank resources for JIT (bundled with app)
      - path: jank-resources/src
        buildPhase: resources
        type: folder
      - path: jank-resources/include
        buildPhase: resources
        type: folder
      - path: jank-resources/clang
        buildPhase: resources
        type: folder
    entitlements:
      path: jank-jit.entitlements
