name: CI

on:
  push:
    branches: [main, master, develop]
  pull_request:
    branches: [main, master, develop]
  workflow_dispatch:

env:
  JANK_REPO: pfeodrippe/jank
  JANK_REF: nrepl
  HOMEBREW_NO_AUTO_UPDATE: 1
  # Skip AOT check in check-health - spawned subprocess loads Swift/Cocoa frameworks
  # that expect newer C++ symbols not in jank's bundled LLVM libc++abi
  JANK_SKIP_AOT_CHECK: 1

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # ============================================================================
  # Get jank commit hash for caching
  # ============================================================================
  get-jank-commit:
    name: Get jank commit hash
    runs-on: ubuntu-latest
    outputs:
      commit: ${{ steps.get-commit.outputs.commit }}
    steps:
      - name: Get jank commit hash
        id: get-commit
        run: |
          COMMIT=$(git ls-remote https://github.com/${{ env.JANK_REPO }}.git refs/heads/${{ env.JANK_REF }} | cut -f1)
          echo "commit=$COMMIT" >> $GITHUB_OUTPUT
          echo "jank commit: $COMMIT"

  # ============================================================================
  # macOS Pipeline (runs in parallel with Linux)
  # ============================================================================
  build-jank-macos:
    name: Build jank - macOS
    needs: get-jank-commit
    runs-on: macos-15
    timeout-minutes: 200
    steps:
      - name: Clone jank
        run: |
          git clone --depth 1 --recurse-submodules --branch ${{ env.JANK_REF }} https://github.com/${{ env.JANK_REPO }}.git ~/jank

      - name: Install Homebrew deps
        run: |
          brew install git pkg-config ninja python cmake zlib double-conversion boost openssl doctest

      # Cache 1: Clang/LLVM (rarely changes, keyed by branch)
      # Includes LLVM source (build/llvm) for iOS LLVM cross-compilation
      - name: Cache Clang/LLVM
        id: cache-clang
        uses: actions/cache@v4
        with:
          path: |
            ~/jank/compiler+runtime/build/llvm-install
            ~/jank/compiler+runtime/build/llvm
          key: clang-macos-arm64-${{ env.JANK_REF }}-v2

      - name: Build Clang/LLVM
        if: steps.cache-clang.outputs.cache-hit != 'true'
        run: |
          export SDKROOT="$(xcrun --sdk macosx --show-sdk-path)"
          cd ~/jank/compiler+runtime
          ./bin/build-clang
          ~/jank/compiler+runtime/build/llvm-install/usr/local/bin/clang++ --version

      # Cache 2: jank build (keyed by commit hash)
      - name: Cache jank build
        id: cache-jank
        uses: actions/cache@v4
        with:
          path: |
            ~/jank/compiler+runtime/build/jank
            ~/jank/compiler+runtime/build/jank-phase-1
            ~/jank/compiler+runtime/build/CMakeCache.txt
            ~/jank/compiler+runtime/build/CMakeFiles
            ~/jank/compiler+runtime/build/*.a
            ~/jank/compiler+runtime/build/*.ninja
            ~/jank/compiler+runtime/build/lib
            ~/jank/compiler+runtime/build/core-libs
            ~/jank/compiler+runtime/build/classes
          key: jank-build-macos-arm64-${{ needs.get-jank-commit.outputs.commit }}-v5

      - name: Build jank
        if: steps.cache-jank.outputs.cache-hit != 'true'
        run: |
          export SDKROOT="$(xcrun --sdk macosx --show-sdk-path)"
          export CC=$HOME/jank/compiler+runtime/build/llvm-install/usr/local/bin/clang
          export CXX=$HOME/jank/compiler+runtime/build/llvm-install/usr/local/bin/clang++
          cd ~/jank/compiler+runtime
          ./bin/configure -GNinja -DCMAKE_BUILD_TYPE=Release \
            -Dllvm_dir=$HOME/jank/compiler+runtime/build/llvm-install/usr/local
          ./bin/compile
          echo "jank build complete"
          ~/jank/compiler+runtime/build/jank check-health

  build-macos:
    name: Build and Test - macOS
    needs: [get-jank-commit, build-jank-macos]
    runs-on: macos-15
    timeout-minutes: 60
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Ensure submodules are initialized
        run: |
          git submodule update --init --recursive
          ls -la vendor/JoltPhysics/CMakeLists.txt || echo "WARNING: JoltPhysics not properly cloned"

      - name: Clone jank (for source files)
        run: |
          git clone --depth 1 --recurse-submodules --branch ${{ env.JANK_REF }} https://github.com/${{ env.JANK_REPO }}.git ~/jank

      - name: Install Homebrew deps
        run: |
          brew install cmake ninja double-conversion pkg-config llvm ccache boost openssl zlib doctest
          brew install openssl@3 zstd sdl3 vulkan-loader shaderc molten-vk xcodegen

      - name: Restore Clang/LLVM cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/jank/compiler+runtime/build/llvm-install
            ~/jank/compiler+runtime/build/llvm
          key: clang-macos-arm64-${{ env.JANK_REF }}-v2

      - name: Restore jank build cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/jank/compiler+runtime/build/jank
            ~/jank/compiler+runtime/build/jank-phase-1
            ~/jank/compiler+runtime/build/CMakeCache.txt
            ~/jank/compiler+runtime/build/CMakeFiles
            ~/jank/compiler+runtime/build/*.a
            ~/jank/compiler+runtime/build/*.ninja
            ~/jank/compiler+runtime/build/lib
            ~/jank/compiler+runtime/build/core-libs
            ~/jank/compiler+runtime/build/classes
          key: jank-build-macos-arm64-${{ needs.get-jank-commit.outputs.commit }}-v5

      - name: Verify jank
        run: |
          ~/jank/compiler+runtime/build/jank check-health

      - name: Set up environment
        run: |
          echo "$HOME/jank/compiler+runtime/build" >> $GITHUB_PATH

      - name: Run tests
        run: |
          export SDKROOT="$(xcrun --sdk macosx --show-sdk-path)"
          export PATH="$HOME/jank/compiler+runtime/build:$PATH"
          make test JANK_SRC="$HOME/jank/compiler+runtime"

      - name: Build standalone app
        run: |
          export SDKROOT="$(xcrun --sdk macosx --show-sdk-path)"
          export PATH="$HOME/jank/compiler+runtime/build:$PATH"
          make sdf-standalone JANK_SRC="$HOME/jank/compiler+runtime"

      - name: Upload DMG artifact
        uses: actions/upload-artifact@v4
        with:
          name: SDFViewer-macOS
          path: SDFViewer.dmg
          if-no-files-found: error

  # ============================================================================
  # iOS Simulator Builds (run in parallel with macOS tests)
  # ============================================================================
  build-ios-aot:
    name: Build iOS AOT Simulator
    needs: [get-jank-commit, build-jank-macos]
    runs-on: macos-15
    timeout-minutes: 60
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Clone jank (for source files)
        run: |
          git clone --depth 1 --recurse-submodules --branch ${{ env.JANK_REF }} https://github.com/${{ env.JANK_REPO }}.git ~/jank

      - name: Install Homebrew deps
        run: |
          brew install cmake ninja double-conversion pkg-config llvm ccache boost openssl zlib doctest
          brew install openssl@3 zstd sdl3 vulkan-loader shaderc molten-vk xcodegen

      - name: Restore Clang/LLVM cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/jank/compiler+runtime/build/llvm-install
            ~/jank/compiler+runtime/build/llvm
          key: clang-macos-arm64-${{ env.JANK_REF }}-v2

      - name: Restore jank build cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/jank/compiler+runtime/build/jank
            ~/jank/compiler+runtime/build/jank-phase-1
            ~/jank/compiler+runtime/build/CMakeCache.txt
            ~/jank/compiler+runtime/build/CMakeFiles
            ~/jank/compiler+runtime/build/*.a
            ~/jank/compiler+runtime/build/*.ninja
            ~/jank/compiler+runtime/build/lib
            ~/jank/compiler+runtime/build/core-libs
            ~/jank/compiler+runtime/build/classes
          key: jank-build-macos-arm64-${{ needs.get-jank-commit.outputs.commit }}-v5

      - name: Verify jank
        run: |
          ~/jank/compiler+runtime/build/jank check-health

      # Cache iOS frameworks (MoltenVK, SDL3) - takes ~10 min to build SDL3
      # v2: Added vk_video headers for Vulkan video codec support
      - name: Cache iOS Frameworks
        id: cache-ios-frameworks
        uses: actions/cache@v4
        with:
          path: SdfViewerMobile/Frameworks
          key: ios-frameworks-v2

      # Setup iOS dependencies (downloads MoltenVK, builds SDL3)
      - name: Setup iOS Dependencies
        if: steps.cache-ios-frameworks.outputs.cache-hit != 'true'
        run: |
          cd SdfViewerMobile && ./setup_ios_deps.sh

      # Create placeholder for gitignored resource files
      - name: Create placeholder resources
        run: |
          # exported_scene.glb is gitignored but required by Xcode build
          touch SdfViewerMobile/exported_scene.glb

      - name: Build iOS AOT Simulator
        run: |
          export SDKROOT="$(xcrun --sdk macosx --show-sdk-path)"
          export PATH="$HOME/jank/compiler+runtime/build:$PATH"
          make ios-aot-sim-build JANK_SRC="$HOME/jank/compiler+runtime"

  build-ios-jit:
    name: Build iOS JIT Simulator
    needs: [get-jank-commit, build-jank-macos]
    runs-on: macos-15
    timeout-minutes: 180  # Increased for iOS LLVM build
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Clone jank (for source files)
        run: |
          git clone --depth 1 --recurse-submodules --branch ${{ env.JANK_REF }} https://github.com/${{ env.JANK_REPO }}.git ~/jank

      - name: Install Homebrew deps
        run: |
          brew install cmake ninja double-conversion pkg-config llvm ccache boost openssl zlib doctest
          brew install openssl@3 zstd sdl3 vulkan-loader shaderc molten-vk xcodegen

      - name: Restore Clang/LLVM cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/jank/compiler+runtime/build/llvm-install
            ~/jank/compiler+runtime/build/llvm
          key: clang-macos-arm64-${{ env.JANK_REF }}-v2

      - name: Restore jank build cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/jank/compiler+runtime/build/jank
            ~/jank/compiler+runtime/build/jank-phase-1
            ~/jank/compiler+runtime/build/CMakeCache.txt
            ~/jank/compiler+runtime/build/CMakeFiles
            ~/jank/compiler+runtime/build/*.a
            ~/jank/compiler+runtime/build/*.ninja
            ~/jank/compiler+runtime/build/lib
            ~/jank/compiler+runtime/build/core-libs
            ~/jank/compiler+runtime/build/classes
          key: jank-build-macos-arm64-${{ needs.get-jank-commit.outputs.commit }}-v5

      - name: Verify jank
        run: |
          ~/jank/compiler+runtime/build/jank check-health

      # Cache iOS frameworks (MoltenVK, SDL3) - takes ~10 min to build SDL3
      # v2: Added vk_video headers for Vulkan video codec support
      - name: Cache iOS Frameworks
        id: cache-ios-frameworks
        uses: actions/cache@v4
        with:
          path: SdfViewerMobile/Frameworks
          key: ios-frameworks-v2

      # Setup iOS dependencies (downloads MoltenVK, builds SDL3)
      - name: Setup iOS Dependencies
        if: steps.cache-ios-frameworks.outputs.cache-hit != 'true'
        run: |
          cd SdfViewerMobile && ./setup_ios_deps.sh

      # Create placeholder for gitignored resource files
      - name: Create placeholder resources
        run: |
          # exported_scene.glb is gitignored but required by Xcode build
          touch SdfViewerMobile/exported_scene.glb

      # Restore iOS LLVM cache (keyed by jank branch, rarely changes)
      # This is the cross-compiled LLVM for iOS simulator (~541MB)
      - name: Restore iOS LLVM cache (simulator)
        id: cache-ios-llvm
        uses: actions/cache/restore@v4
        with:
          path: ~/dev/ios-llvm-build/ios-llvm-simulator
          key: ios-llvm-simulator-${{ env.JANK_REF }}-v1

      # Build iOS LLVM if not cached (takes ~2 hours first time)
      - name: Build iOS LLVM
        if: steps.cache-ios-llvm.outputs.cache-hit != 'true'
        run: |
          export SDKROOT="$(xcrun --sdk macosx --show-sdk-path)"
          cd ~/jank/compiler+runtime
          # Patch CppInterOp to support LLVM 22.x (upstream only supports up to 19.1.x)
          sed -i '' 's/CLANG_MAX_SUPPORTED "19.1.x"/CLANG_MAX_SUPPORTED "22.x"/' third-party/cppinterop/CMakeLists.txt
          sed -i '' 's/CLANG_VERSION_UPPER_BOUND 20.0.0/CLANG_VERSION_UPPER_BOUND 23.0.0/' third-party/cppinterop/CMakeLists.txt
          sed -i '' 's/LLD_MAX_SUPPORTED "19.1.x"/LLD_MAX_SUPPORTED "22.x"/' third-party/cppinterop/CMakeLists.txt
          sed -i '' 's/LLD_VERSION_UPPER_BOUND 20.0.0/LLD_VERSION_UPPER_BOUND 23.0.0/' third-party/cppinterop/CMakeLists.txt
          sed -i '' 's/LLVM_MAX_SUPPORTED "19.1.x"/LLVM_MAX_SUPPORTED "22.x"/' third-party/cppinterop/CMakeLists.txt
          sed -i '' 's/LLVM_VERSION_UPPER_BOUND 20.0.0/LLVM_VERSION_UPPER_BOUND 23.0.0/' third-party/cppinterop/CMakeLists.txt
          ./bin/build-ios-llvm simulator

      # Save iOS LLVM cache immediately after building (don't wait for job end)
      # This ensures cache is saved even if later steps fail
      - name: Save iOS LLVM cache (simulator)
        if: steps.cache-ios-llvm.outputs.cache-hit != 'true'
        uses: actions/cache/save@v4
        with:
          path: ~/dev/ios-llvm-build/ios-llvm-simulator
          key: ios-llvm-simulator-${{ env.JANK_REF }}-v1

      # Build jank iOS JIT libraries (libjank.a, etc. for iOS simulator with JIT)
      - name: Build jank iOS JIT libs
        run: |
          export SDKROOT="$(xcrun --sdk macosx --show-sdk-path)"
          cd ~/jank/compiler+runtime
          ./bin/build-ios build-ios-sim-jit Debug simulator jit

      - name: Build iOS JIT Simulator
        run: |
          export SDKROOT="$(xcrun --sdk macosx --show-sdk-path)"
          export PATH="$HOME/jank/compiler+runtime/build:$PATH"
          make ios-jit-sim-build JANK_SRC="$HOME/jank/compiler+runtime"

  # ============================================================================
  # Linux Pipeline (runs in parallel with macOS)
  # DISABLED: jank has a TLS symbol export issue on Linux with emulated TLS
  # See: https://github.com/pfeodrippe/jank-examples/issues/XXX
  # ============================================================================
  build-jank-linux:
    name: Build jank - Linux
    if: false  # DISABLED - jank TLS issue on Linux
    needs: get-jank-commit
    runs-on: ubuntu-24.04
    timeout-minutes: 200
    steps:
      - name: Clone jank
        run: |
          git clone --depth 1 --recurse-submodules --branch ${{ env.JANK_REF }} https://github.com/${{ env.JANK_REPO }}.git ~/jank

      - name: Install apt deps
        run: |
          sudo apt-get update
          sudo apt-get install -y curl git build-essential libssl-dev libdouble-conversion-dev \
            pkg-config ninja-build cmake zlib1g-dev libffi-dev libboost-dev libboost-system-dev \
            doctest-dev libgc-dev

      # Cache 1: Clang/LLVM (rarely changes, keyed by branch)
      # Bump version if jank's LLVM requirements change
      - name: Cache Clang/LLVM
        id: cache-clang
        uses: actions/cache@v4
        with:
          path: ~/jank/compiler+runtime/build/llvm-install
          key: clang-linux-x64-${{ env.JANK_REF }}-v1
          save-always: true

      - name: Build Clang/LLVM
        if: steps.cache-clang.outputs.cache-hit != 'true'
        run: |
          cd ~/jank/compiler+runtime
          ./bin/build-clang
          ~/jank/compiler+runtime/build/llvm-install/usr/local/bin/clang++ --version

      # Cache 2: jank build (keyed by commit hash)
      # NO restore-keys fallback! Partial/stale caches cause ABI issues like:
      # "Symbols not found: [ __emutls_v._ZN4jank7runtime17current_allocatorE ]"
      - name: Cache jank build
        id: cache-jank
        uses: actions/cache@v4
        with:
          path: |
            ~/jank/compiler+runtime/build/jank
            ~/jank/compiler+runtime/build/jank-phase-1
            ~/jank/compiler+runtime/build/CMakeCache.txt
            ~/jank/compiler+runtime/build/CMakeFiles
            ~/jank/compiler+runtime/build/*.a
            ~/jank/compiler+runtime/build/*.o
            ~/jank/compiler+runtime/build/**/*.o
            ~/jank/compiler+runtime/build/*.ninja
            ~/jank/compiler+runtime/build/lib
            ~/jank/compiler+runtime/build/core-libs
            ~/jank/compiler+runtime/build/classes
          key: jank-build-linux-x64-${{ needs.get-jank-commit.outputs.commit }}-v14

      # Cache 3: PCH separately (takes 1h30 to build)
      # NO restore-keys fallback! PCH must match exact commit or compilation fails
      - name: Cache PCH
        id: cache-pch
        uses: actions/cache@v4
        with:
          path: ~/jank/compiler+runtime/build/incremental.pch
          key: jank-pch-linux-x64-${{ needs.get-jank-commit.outputs.commit }}-v4

      - name: Create swap space
        if: steps.cache-jank.outputs.cache-hit != 'true' || steps.cache-pch.outputs.cache-hit != 'true'
        run: |
          # Create 8GB swap to handle PCH generation memory requirements
          sudo fallocate -l 8G /swapfile
          sudo chmod 600 /swapfile
          sudo mkswap /swapfile
          sudo swapon /swapfile
          free -h

      - name: Build jank
        if: steps.cache-jank.outputs.cache-hit != 'true' || steps.cache-pch.outputs.cache-hit != 'true'
        run: |
          export CC=$HOME/jank/compiler+runtime/build/llvm-install/usr/local/bin/clang
          export CXX=$HOME/jank/compiler+runtime/build/llvm-install/usr/local/bin/clang++
          cd ~/jank/compiler+runtime
          # Use same flags as macOS for consistent LLVM configuration
          ./bin/configure -GNinja -DCMAKE_BUILD_TYPE=Release \
            -Dllvm_dir=$HOME/jank/compiler+runtime/build/llvm-install/usr/local
          ./bin/compile
          echo "jank build complete"
          ~/jank/compiler+runtime/build/jank check-health

  build-linux:
    name: Build and Test - Linux
    if: false  # DISABLED - jank TLS issue on Linux
    needs: [get-jank-commit, build-jank-linux]
    runs-on: ubuntu-24.04
    timeout-minutes: 90
    steps:
      - name: Free disk space
        run: |
          echo "=== Disk space before cleanup ==="
          df -h
          # Remove large pre-installed tools we don't need
          sudo rm -rf /usr/share/dotnet
          sudo rm -rf /usr/local/lib/android
          sudo rm -rf /opt/ghc
          sudo rm -rf /opt/hostedtoolcache/CodeQL
          sudo rm -rf /usr/local/share/boost
          sudo rm -rf /usr/share/swift
          # Clean apt cache
          sudo apt-get clean
          echo "=== Disk space after cleanup ==="
          df -h

      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Create swap space
        run: |
          # 8GB swap for jank AOT compilation (reduced to save disk space)
          sudo fallocate -l 8G /swapfile
          sudo chmod 600 /swapfile
          sudo mkswap /swapfile
          sudo swapon /swapfile
          free -h
          df -h

      - name: Clone jank (for source files)
        run: |
          git clone --depth 1 --recurse-submodules --branch ${{ env.JANK_REF }} https://github.com/${{ env.JANK_REPO }}.git ~/jank

      - name: Install apt deps
        run: |
          sudo apt-get update
          sudo apt-get install -y curl git build-essential libssl-dev libdouble-conversion-dev \
            pkg-config ninja-build cmake zlib1g-dev libffi-dev libboost-dev libboost-system-dev \
            doctest-dev libgc-dev ccache patchelf
          # Vulkan deps (SDL3 built from source below)
          sudo apt-get install -y libvulkan-dev glslang-tools libshaderc-dev libshaderc1
          # X11/Wayland deps for SDL3
          sudo apt-get install -y libx11-dev libxext-dev libxrandr-dev libxcursor-dev libxi-dev libxss-dev

      - name: Cache SDL3
        id: cache-sdl3
        uses: actions/cache@v4
        with:
          path: ~/SDL3-install
          key: sdl3-linux-x64-3.2.x-v2
          save-always: true

      - name: Build SDL3 from source
        if: steps.cache-sdl3.outputs.cache-hit != 'true'
        run: |
          # SDL3 not in Ubuntu 24.04 repos, build from source
          git clone --depth 1 --branch release-3.2.x https://github.com/libsdl-org/SDL.git ~/SDL3
          cd ~/SDL3
          cmake -B build -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=$HOME/SDL3-install
          cmake --build build -j$(nproc)
          cmake --install build

      - name: Install SDL3
        run: |
          sudo cp -r ~/SDL3-install/* /usr/local/
          sudo ldconfig

      - name: Restore Clang/LLVM cache
        uses: actions/cache/restore@v4
        with:
          path: ~/jank/compiler+runtime/build/llvm-install
          key: clang-linux-x64-${{ env.JANK_REF }}-v1

      - name: Restore jank build cache
        uses: actions/cache/restore@v4
        with:
          path: |
            ~/jank/compiler+runtime/build/jank
            ~/jank/compiler+runtime/build/jank-phase-1
            ~/jank/compiler+runtime/build/CMakeCache.txt
            ~/jank/compiler+runtime/build/CMakeFiles
            ~/jank/compiler+runtime/build/*.a
            ~/jank/compiler+runtime/build/*.o
            ~/jank/compiler+runtime/build/**/*.o
            ~/jank/compiler+runtime/build/*.ninja
            ~/jank/compiler+runtime/build/lib
            ~/jank/compiler+runtime/build/core-libs
            ~/jank/compiler+runtime/build/classes
          key: jank-build-linux-x64-${{ needs.get-jank-commit.outputs.commit }}-v14
          # NO restore-keys! Must match exact build from build-jank-linux job

      - name: Restore PCH cache
        uses: actions/cache/restore@v4
        with:
          path: ~/jank/compiler+runtime/build/incremental.pch
          key: jank-pch-linux-x64-${{ needs.get-jank-commit.outputs.commit }}-v4
          # NO restore-keys fallback! PCH must match exact commit or it will fail with
          # "file has been modified since the precompiled header was built"

      - name: Verify jank
        run: |
          ~/jank/compiler+runtime/build/jank check-health

      - name: Set up environment
        run: |
          echo "$HOME/jank/compiler+runtime/build" >> $GITHUB_PATH

      - name: Run tests
        run: |
          export PATH="$HOME/jank/compiler+runtime/build:$PATH"
          make test JANK_SRC="$HOME/jank/compiler+runtime"

      - name: Build standalone app
        run: |
          export PATH="$HOME/jank/compiler+runtime/build:$PATH"
          echo "=== Starting build at $(date) ==="
          echo "=== Memory status ==="
          free -h
          echo "=== Running full standalone build ==="
          time make sdf-standalone JANK_SRC="$HOME/jank/compiler+runtime"
          echo "=== Build complete at $(date) ==="

      - name: Upload Linux tarball artifact
        uses: actions/upload-artifact@v4
        with:
          name: SDFViewer-Linux
          path: SDFViewer-linux.tar.gz
          if-no-files-found: error
